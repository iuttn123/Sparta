<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>

    <!-- AJAX -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    <title>보드게임 홈페이지</title>

    <!-- 구글폰트 -->
    <link href="https://fonts.googleapis.com/css?family=Stylish&display=swap" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="Main.css">

    <script>

        let total_won = Number('0');
        let total_dollar = Number('0');

        function find() {
            console.log("작동");
        }
        function openclose() {
            // post-box가 안보일 때
            if ($("#post-box").css("display") == "none") {
                $("#post-box").show();
                $("#btn-post-box").text("구매목록 박스 닫기");
            }

            // post-box가 보일 때
            else {
                $("#post-box").hide();
                $("#btn-post-box").text("구매목록 박스 열기");
            }
        }

        function buy(item, dollar, won) {
            $("#list").append("<li>" + item + "</li>");
            $("#id_dollar").append("<li>" + dollar + "$" + "</li>");
            $("#id_won").append("<li>" + won + "₩" + "</li>");
            let number_won = Number(won);
            let number_dollar = Number(dollar);
            total_won += number_won;
            total_dollar += number_dollar;
            $("#total_dollar").html(total_dollar+"$  ");
            $("#total_won").html(total_won+"₩");
        }

        function make_defalut(){
            $("#list").html('');
            $("#total_dollar").html('');
            $("#total_won").html('');

            $("#id_dollar").html('');
            $("#id_won").html('');
            
        }

        function decision(){

            var number = $('#phone').val()
            var buy = $('#list').get(0)

            console.log(buy);
                        

            if(!$('#list').get(0)){
                alert("구매할 제품을 선택해주세요!");
            }
            else if(!$('#customer').val()){
                alert("주문자를 이름을 입력해주세요!");
            }
            else if(!$('#address').val()){
                alert("주소를 입력해 주세요!");
            }
            else if(number.indexOf('010-')){
                console.log(number)
                alert("010-0000-0000 형식으로 해주세요!");
            }
            else{
                let num = number.split('-')
                if(num[1]<1000||num[1]>9999) alert("010-0000-0000 형식으로 해주세요!");
                else if(num[2]<1000||num[2]>9999) alert("010-0000-0000 형식으로 해주세요!");
                else alert("주문이 완료 되었습니다. 감사합니다.")
            }
        }



    </script>


</head>

<body>
    <div class="wrap">
        <div class="jumbotron">
            <h1 class="display-4">어떤 보드게임을 살까?!</h1>
            <hr class="my-4">
            <p class="lead">
                <a id="btn-post-box" onclick="openclose()" class="btn btn-primary btn-lg" href="#" role="button">구매목록 박스 닫기</a>
            </p>
            <p class="lead">
                <a id="btn-post-box" onclick="find()" class="btn btn-primary btn-lg" href="#" role="button">찾고싶은 보드게임 찾기!(구현중...)</a>
            </p>
        </div>

        <div class="form-post" id="post-box">
            <div>
                <div class="form-group">
                    <label for="exampleFormControlInput1">구매 목록</label>
                    <ul id="list"></ul>

                    <label for="price">총 구매 가격: <span id="total_dollar"></span> <span id="total_won"></span> </label>
                    <ul id="price_list">
                        <li id="id_dollar"></li>
                        <li id="id_won"></li>
                    </ul>

                </div>
                <div class="form-group">
                    <label>주문자 이름</label>
                    <textarea class="form-control" rows="1" id="customer"></textarea>

                    <label>주소</label>
                    <textarea class="form-control" rows="1" id="address"></textarea>

                    <label>전화번호</label>
                    <textarea class="form-control" rows="1" id="phone"></textarea>
                </div>
                <button type="button" class="btn btn-primary" onclick="decision()">
                    구매하기
                </button>

                <button type="button" class="btn btn-primary" onclick="make_defalut()">
                    구매목록 초기화
                </button>

            </div>
        </div>
        <div class="card-columns" id="card-boxs">
            <script>
                var rate;
                var one;
                $.ajax({
                    type: "GET",
                    url: "https://api.manana.kr/exchange/rate.json",
                    data: {},
                    success: function (response) {
                        let list = response[1];
                        rate = list['rate'];
                        console.log(rate);
                    },
                });


                $.ajax({

                    type: "GET",
                    url: "https://www.boardgameatlas.com/api/search?order_by=popularity&ascending=false&client_id=SB1VGnDv7M",
                    data: {},
                    success: function (response) {
                        console.log("아몰랑");
                        let gameslist = response["games"];
                        let name_list = new Array(100);
                        let min_player_list = new Array(100);
                        let max_player_list = new Array(100);
                        let avg_play_time = new Array(100);
                        let url = new Array(100);
                        let dollar = new Array(100);
                        let won = new Array(100);

                        let template = new Array(100);

                        // console.log(gameslist)

                        for (let i = 0; i < gameslist.length; i++) {
                            name_list[i] = gameslist[i]["name"]
                            min_player_list[i] = gameslist[i]["min_players"]
                            max_player_list[i] = gameslist[i]["max_players"]
                            avg_play_time[i] = (gameslist[i]["min_playtime"] + gameslist[i]["max_playtime"]) / 2;
                            dollar[i] = Math.round(gameslist[i]['price']);
                            won[i] = Math.round(dollar[i] * rate);
                            url[i] = gameslist[i]["image_url"]

                            console.log(name_list[i]);
                            template[i] = ` <div class="card">
                                            <img class="card-img-top"
                                                src=${url[i]}
                                                alt="Card image cap">
                                            <div class="card-body">
                                                <a href="#" class="card-title" id="${name_list[i]}" onclick="buy('${name_list[i]}','${dollar[i]}','${won[i]}')"> ${name_list[i]}</a>
                                                <p class="card-text">최소인원: ${min_player_list[i]}</p>
                                                <p class="card-text">최대인원: ${max_player_list[i]}</p>
                                                <p class="card-text">평균시간: ${avg_play_time[i]} 분</p>
                                                <p class="card-text">달러: ${dollar[i]} 달러</p>
                                                <p class="card-text">원화: ${won[i]} 원</p>
                                            </div>
                                            </div>`

                            $("#card-boxs").append(template[i]);
                        }
                    },
                });
            </script>
        </div>

    </div>
</body>

<!-- <p class="card-text comment" onclick="buy(${name_list[i]})">구매 하고 싶으면 클릭하세요!</p> -->

</html>